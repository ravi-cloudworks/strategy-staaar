<!DOCTYPE html>
<html>
<head>
    <title>Supabase Connection Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body>
    <h1>Supabase Test</h1>
    <div id="results"></div>

    <script>
        const SUPABASE_URL = "https://yxicubfthxkwqcihrdhe.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4aWN1YmZ0aHhrd3FjaWhyZGhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjg3NDEsImV4cCI6MjA3MzgwNDc0MX0.-w4VQhAIF0kYLHv87JazGLxgX-r4VXCJaPVSmOUher4";

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const results = document.getElementById('results');

        async function test() {
            results.innerHTML += '<h2>Testing Supabase Connection...</h2>';

            // Test basic database connection first (no auth needed)
            try {
                results.innerHTML += '<p>üîç Testing basic database connection...</p>';
                const { data, error } = await supabase
                    .from('feedback_requests')
                    .select('count')
                    .limit(1);

                if (error) {
                    results.innerHTML += `<p>‚ùå Database error: ${error.message}</p>`;
                } else {
                    results.innerHTML += `<p>‚úÖ Database connection works</p>`;
                }
            } catch (e) {
                results.innerHTML += `<p>‚ùå Database exception: ${e.message}</p>`;
            }

            // Test 1: Check auth session with timeout
            try {
                results.innerHTML += '<p>üîç Testing auth session...</p>';
                const authPromise = supabase.auth.getSession();
                const timeoutPromise = new Promise((_, reject) =>
                    setTimeout(() => reject(new Error('Auth timeout after 5 seconds')), 5000)
                );

                const { data: { session }, error } = await Promise.race([authPromise, timeoutPromise]);
                results.innerHTML += `<p>‚úÖ Auth check: ${session ? 'Logged in' : 'Not logged in'}</p>`;
                if (error) results.innerHTML += `<p>‚ùå Auth error: ${error.message}</p>`;
            } catch (e) {
                results.innerHTML += `<p>‚ùå Auth exception: ${e.message}</p>`;
            }

            // Test 2: Check users_login table
            try {
                const { data, error } = await supabase.from('users_login').select('count').limit(1);
                results.innerHTML += `<p>‚úÖ users_login table accessible</p>`;
                if (error) results.innerHTML += `<p>‚ùå users_login error: ${error.message}</p>`;
            } catch (e) {
                results.innerHTML += `<p>‚ùå users_login exception: ${e.message}</p>`;
            }

            // Test 3: Check feedback_requests table
            try {
                const { data, error } = await supabase.from('feedback_requests').select('count').limit(1);
                results.innerHTML += `<p>‚úÖ feedback_requests table accessible</p>`;
                if (error) results.innerHTML += `<p>‚ùå feedback_requests error: ${error.message}</p>`;
            } catch (e) {
                results.innerHTML += `<p>‚ùå feedback_requests exception: ${e.message}</p>`;
            }

            // Test 4: Check feedback_requests_with_details view
            try {
                const { data, error } = await supabase.from('feedback_requests_with_details').select('*').limit(1);
                results.innerHTML += `<p>‚úÖ feedback_requests_with_details view accessible</p>`;
                if (error) results.innerHTML += `<p>‚ùå feedback_requests_with_details error: ${error.message}</p>`;
            } catch (e) {
                results.innerHTML += `<p>‚ùå feedback_requests_with_details exception: ${e.message}</p>`;
            }

            // Test 5: Try to insert a test record (will fail if not authenticated)
            try {
                const { data, error } = await supabase
                    .from('feedback_requests')
                    .insert([{
                        title: 'Test Request',
                        description: 'Test Description',
                        type: 'feature',
                        created_by: 'test-user-id'
                    }]);
                results.innerHTML += `<p>‚úÖ Insert test passed</p>`;
                if (error) results.innerHTML += `<p>‚ùå Insert error: ${error.message}</p>`;
            } catch (e) {
                results.innerHTML += `<p>‚ùå Insert exception: ${e.message}</p>`;
            }
        }

        test();
    </script>
</body>
</html>