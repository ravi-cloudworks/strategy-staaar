<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://docs.opencv.org; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net data:; img-src 'self' data: https: blob:; media-src 'self' blob: data:; connect-src 'self' https://*.supabase.co https://www.linkedin.com https://*.linkedin.com; frame-ancestors 'self';"><meta http-equiv="X-Content-Type-Options" content="nosniff"><meta name="referrer" content="strict-origin-when-cross-origin"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Feedback - Strategy Staaar</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"><script src="https://unpkg.com/@supabase/supabase-js"></script><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8fafc;color:#2d3748;line-height:1.6}.header{background:#fff;border-bottom:1px solid #e2e8f0;position:sticky;top:0;z-index:50;padding:16px 0}.header-content{max-width:1200px;margin:0 auto;padding:0 32px;display:flex;justify-content:space-between;align-items:center}.logo{font-size:22px;font-weight:700;color:#1a202c;text-decoration:none}.nav{display:flex;gap:32px;align-items:center}.nav-link{color:#718096;text-decoration:none;font-size:15px;font-weight:500;transition:color .2s ease}.nav-link:hover{color:#2d3748}.nav-link.active{color:#667eea;font-weight:600}.user-profile{display:flex;align-items:center;gap:12px;position:relative}.profile-btn{display:flex;align-items:center;gap:8px;background:0 0;border:none;cursor:pointer;padding:8px;border-radius:8px;transition:background .2s ease}.profile-btn:hover{background:#f7fafc}.profile-image{width:32px;height:32px;border-radius:50%;object-fit:cover}.dropdown-menu{position:absolute;top:100%;right:0;background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,.1);min-width:240px;padding:8px;display:none;z-index:100}.dropdown-menu.show{display:block}.dropdown-header{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid #e2e8f0;margin-bottom:8px}.profile-email{font-size:13px;color:#718096}.logout-btn{width:100%;background:0 0;border:none;padding:12px;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:8px;color:#e53e3e;font-weight:500;transition:background .2s ease}.logout-btn:hover{background:#fed7d7}.container{max-width:1000px;margin:0 auto;padding:32px}.page-header{text-align:center;margin-bottom:48px}.page-title{font-size:36px;font-weight:700;color:#1a202c;margin-bottom:12px}.page-subtitle{font-size:18px;color:#718096}.feedback-actions{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:16px}.filter-tabs{display:flex;gap:4px;background:#fff;border-radius:8px;border:1px solid #e2e8f0;padding:4px}.filter-tab{padding:8px 16px;border:none;background:0 0;color:#718096;font-weight:500;border-radius:4px;cursor:pointer;transition:all .2s ease}.filter-tab.active{background:#667eea;color:#fff}.new-feedback-btn{background:#667eea;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .2s ease}.new-feedback-btn:hover{background:#5a67d8}.feedback-form{background:#fff;border-radius:12px;padding:24px;margin-bottom:24px;border:1px solid #e2e8f0;display:none}.feedback-form.show{display:block}.form-group{margin-bottom:16px}.form-label{display:block;font-weight:600;color:#2d3748;margin-bottom:4px}.form-input{width:100%;padding:12px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;transition:border-color .2s ease}.form-input:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.form-textarea{min-height:80px;resize:vertical}.form-actions{display:flex;gap:12px}.btn-primary{background:#667eea;color:#fff;border:none;padding:10px 20px;border-radius:6px;font-weight:600;cursor:pointer;transition:background .2s ease}.btn-primary:hover{background:#5a67d8}.btn-secondary{background:#edf2f7;color:#4a5568;border:none;padding:10px 20px;border-radius:6px;font-weight:600;cursor:pointer}.feedback-list{display:flex;flex-direction:column;gap:16px}.feedback-card{background:#fff;border-radius:12px;padding:24px;border:1px solid #e2e8f0;transition:all .2s ease}.feedback-card:hover{border-color:#cbd5e0;box-shadow:0 4px 12px rgba(0,0,0,.05)}.feedback-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}.feedback-title{font-size:18px;font-weight:600;color:#1a202c;margin-bottom:4px}.feedback-meta{display:flex;align-items:center;gap:12px;font-size:13px;color:#718096}.status-badge{padding:4px 8px;border-radius:12px;font-size:12px;font-weight:600;text-transform:uppercase}.status-pending{background:#fef5e7;color:#d69e2e}.status-in_progress{background:#e6fffa;color:#319795}.status-completed{background:#f0fff4;color:#38a169}.status-rejected{background:#fed7d7;color:#e53e3e}.feedback-description{color:#4a5568;margin-bottom:16px;line-height:1.5}.feedback-actions-row{display:flex;justify-content:space-between;align-items:center}.vote-actions{display:flex;align-items:center;gap:8px}.vote-btn{background:0 0;border:1px solid #e2e8f0;padding:8px 12px;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:14px;transition:all .2s ease}.vote-btn:hover{border-color:#cbd5e0}.vote-btn.voted{background:#667eea;color:#fff;border-color:#667eea}.vote-score{font-weight:600;padding:8px 12px;background:#f7fafc;border-radius:6px;min-width:40px;text-align:center}.empty-state{text-align:center;padding:64px 24px;color:#718096}.empty-state i{font-size:48px;margin-bottom:16px;opacity:.5}.loading{text-align:center;padding:32px;color:#718096}@media (max-width:768px){.container{padding:20px}.feedback-actions{flex-direction:column;align-items:stretch}.feedback-header{flex-direction:column;gap:8px}.feedback-actions-row{flex-direction:column;gap:12px;align-items:flex-start}}</style></head><body><header class="header"><div class="header-content"><a href="index.html" class="logo">STRATEGY STAAAR</a><nav class="nav"><a href="dashboard.html" class="nav-link">Dashboard</a> <a href="#" class="nav-link">Templates</a> <a href="#" class="nav-link">Export</a> <a href="feedback.html" class="nav-link active">Feedback</a></nav><div id="userProfile" class="user-profile" style="display:none"><button id="profileBtn" class="profile-btn"><img id="profileImage" class="profile-image" src="" alt="Profile"> <span id="profileName"></span> <i class="bi bi-chevron-down"></i></button><div id="dropdownMenu" class="dropdown-menu"><div class="dropdown-header"><img id="profileImageDropdown" class="profile-image" src="" alt="Profile"><div><div id="profileNameDropdown"></div><div id="profileEmail" class="profile-email"></div></div></div><button id="logoutBtn" class="logout-btn"><i class="bi bi-box-arrow-right"></i> Sign Out</button></div></div></div></header><div class="container"><div class="page-header"><h1 class="page-title">Feature Feedback</h1><p class="page-subtitle">Suggest features and improvements to help us build a better product</p></div><div class="feedback-actions"><div class="filter-tabs"><button class="filter-tab active" data-filter="all">All Posts</button> <button class="filter-tab" data-filter="mine">My Posts</button></div><button class="new-feedback-btn" id="newFeedbackBtn"><i class="bi bi-plus-circle"></i> Suggest Feature</button></div><div class="feedback-form" id="feedbackForm"><div class="form-group"><label class="form-label" for="feedbackTitle">Feature Title</label> <input type="text" id="feedbackTitle" class="form-input" placeholder="Short, descriptive title" maxlength="100" required></div><div class="form-group"><label class="form-label" for="feedbackDescription">Description</label> <textarea id="feedbackDescription" class="form-input form-textarea" placeholder="Describe the feature and why it would be valuable..." maxlength="500"></textarea></div><div class="form-actions"><button type="button" class="btn-primary" id="submitFeedback">Create Post</button> <button type="button" class="btn-secondary" id="cancelFeedback">Cancel</button></div></div><div id="feedbackList" class="feedback-list"><div class="loading"><i class="bi bi-arrow-clockwise"></i> Waiting for authentication...</div></div></div><script src="js/auth.js"></script><script>let currentUser=null,supabaseClient=null,currentFilter="all",feedbackPosts=[],userVotes={};function initializeFeedback(){console.log("Initializing feedback for user:",currentUser),console.log("Creating independent supabase client for feedback");supabaseClient=supabase.createClient("https://yxicubfthxkwqcihrdhe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4aWN1YmZ0aHhrd3FjaWhyZGhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjg3NDEsImV4cCI6MjA3MzgwNDc0MX0.-w4VQhAIF0kYLHv87JazGLxgX-r4VXCJaPVSmOUher4"),setTimeout(async()=>{try{const e=await window.authManager.getSupabaseClient().auth.getSession();e.data.session&&(await supabaseClient.auth.setSession({access_token:e.data.session.access_token,refresh_token:e.data.session.refresh_token}),console.log("Auth session copied to independent client"))}catch(e){console.log("Failed to copy session:",e)}},500),setupEventListeners(),loadFeedback()}function setupEventListeners(){console.log("Setting up event listeners"),document.querySelectorAll(".filter-tab").forEach(e=>{e.addEventListener("click",e=>{document.querySelectorAll(".filter-tab").forEach(e=>e.classList.remove("active")),e.target.classList.add("active"),currentFilter=e.target.dataset.filter,0===feedbackPosts.length?loadFeedbackData():renderFeedback()})}),document.getElementById("newFeedbackBtn").addEventListener("click",()=>{console.log("New feedback button clicked"),document.getElementById("feedbackForm").classList.add("show"),document.getElementById("feedbackTitle").focus()}),document.getElementById("cancelFeedback").addEventListener("click",()=>{document.getElementById("feedbackForm").classList.remove("show"),clearForm()}),document.getElementById("submitFeedback").addEventListener("click",submitFeedback),console.log("Event listeners set up successfully")}async function loadFeedback(){console.log("Skipping initial data load due to timeout issues - showing empty state"),document.getElementById("feedbackList").innerHTML='\n                <div class="empty-state">\n                    <i class="bi bi-lightbulb"></i>\n                    <h3>Ready to get started!</h3>\n                    <p>Click "Suggest Feature" to add your first feedback post.</p>\n                </div>\n            ',console.log("Feedback system ready - buttons should work")}async function loadFeedbackData(){console.log("Loading feedback data on demand...");const e=await supabaseClient.auth.getSession();console.log("Auth session in feedback:",e.data.session?.user?.id),console.log("Current user ID:",currentUser.id),document.getElementById("feedbackList").innerHTML='\n                <div class="loading">\n                    <i class="bi bi-arrow-clockwise"></i>\n                    Testing simple query...\n                </div>\n            ';try{console.log("Testing simple query without JOIN...");const{data:e,error:t}=await supabaseClient.from("feedback_posts").select("*").order("created_at",{ascending:!1});if(console.log("Simple query result:",{posts:e?.length||0,error:t}),t)throw t;feedbackPosts=e||[],console.log("Loaded",feedbackPosts.length,"posts successfully"),renderFeedback()}catch(e){console.error("Error loading feedback data:",e),document.getElementById("feedbackList").innerHTML=`\n                    <div class="empty-state">\n                        <i class="bi bi-exclamation-triangle"></i>\n                        <h3>Unable to load posts</h3>\n                        <p>Error: ${e.message}</p>\n                    </div>\n                `}}function renderFeedback(){console.log("Rendering feedback with filter:",currentFilter);const e=document.getElementById("feedbackList");let t=feedbackPosts;if("mine"===currentFilter&&(t=feedbackPosts.filter(e=>e.user_id===currentUser.id)),0===t.length){const t="mine"===currentFilter?"You haven't submitted any feedback yet.":"No feedback posts yet. Be the first to suggest a feature!";return void(e.innerHTML=`\n                    <div class="empty-state">\n                        <i class="bi bi-lightbulb"></i>\n                        <h3>No feedback yet</h3>\n                        <p>${t}</p>\n                    </div>\n                `)}e.innerHTML=t.map(e=>{const t=userVotes[e.id],s=e.user_id===currentUser.id,n=new Date(e.created_at).toLocaleDateString();return`\n                    <div class="feedback-card">\n                        <div class="feedback-header">\n                            <div>\n                                <h3 class="feedback-title">${escapeHtml(e.title)}</h3>\n                                <div class="feedback-meta">\n                                    <span>by ${s?"you":escapeHtml(e.users_login?.name||"User")}</span>\n                                    <span>â€¢</span>\n                                    <span>${n}</span>\n                                </div>\n                            </div>\n                            <span class="status-badge status-${e.status}">${e.status.replace("_"," ")}</span>\n                        </div>\n                        \n                        ${e.description?`<p class="feedback-description">${escapeHtml(e.description)}</p>`:""}\n                        \n                        <div class="feedback-actions-row">\n                            <div class="vote-actions">\n                                <button class="vote-btn ${"upvote"===t?"voted":""}" \n                                        onclick="vote('${e.id}', 'upvote')"\n                                        title="${"upvote"===t?"Remove upvote":"Upvote"}">\n                                    <i class="bi bi-arrow-up"></i>\n                                    ${"upvote"===t?"Upvoted":"Upvote"}\n                                </button>\n                                <div class="vote-score">${e.vote_score}</div>\n                                <button class="vote-btn ${"downvote"===t?"voted":""}" \n                                        onclick="vote('${e.id}', 'downvote')"\n                                        title="${"downvote"===t?"Remove downvote":"Downvote"}">\n                                    <i class="bi bi-arrow-down"></i>\n                                    ${"downvote"===t?"Downvoted":"Downvote"}\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `}).join("")}async function submitFeedback(){console.log("Submitting feedback...");const e=document.getElementById("feedbackTitle").value.trim(),t=document.getElementById("feedbackDescription").value.trim();if(e)try{console.log("Attempting insert with timeout...");const s=supabaseClient.from("feedback_posts").insert({user_id:currentUser.id,title:e,description:t||null}).select("\n                        *,\n                        users_login!inner(name, avatar_url)\n                    ").single(),n=new Promise((e,t)=>setTimeout(()=>t(new Error("Submit timeout")),8e3)),o=await Promise.race([s,n]);console.log("Insert completed successfully:",o),clearForm(),document.getElementById("feedbackForm").classList.remove("show"),alert("Feedback submitted successfully! It may take a moment to appear in the list."),setTimeout(()=>{feedbackPosts.length>0&&loadFeedbackData()},1e3)}catch(e){console.error("Error submitting feedback:",e),"Submit timeout"===e.message?(clearForm(),document.getElementById("feedbackForm").classList.remove("show"),alert('Feedback submitted but confirmation timed out. Please check "My Posts" to see if it was saved.')):alert("Error submitting feedback. Please try again.")}else alert("Please enter a title for your feedback.")}async function vote(e,t){console.log("Voting:",e,t);try{if(userVotes[e]===t){const{error:t}=await supabaseClient.from("feedback_votes").delete().eq("feedback_post_id",e).eq("user_id",currentUser.id);if(t)throw t;delete userVotes[e]}else{const{error:s}=await supabaseClient.from("feedback_votes").upsert({feedback_post_id:e,user_id:currentUser.id,vote_type:t});if(s)throw s;userVotes[e]=t}const{data:s}=await supabaseClient.from("feedback_votes").select("vote_type").eq("feedback_post_id",e),n=s?.filter(e=>"upvote"===e.vote_type).length||0,o=n-(s?.filter(e=>"downvote"===e.vote_type).length||0);await supabaseClient.from("feedback_posts").update({vote_score:o}).eq("id",e);const a=feedbackPosts.findIndex(t=>t.id===e);-1!==a&&(feedbackPosts[a].vote_score=o),feedbackPosts.sort((e,t)=>t.vote_score!==e.vote_score?t.vote_score-e.vote_score:new Date(t.created_at)-new Date(e.created_at)),renderFeedback()}catch(e){console.error("Error voting:",e),alert("Error recording vote. Please try again.")}}function clearForm(){document.getElementById("feedbackTitle").value="",document.getElementById("feedbackDescription").value=""}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async function testBasicQuery(){try{console.log("Testing basic table access...");const e=await supabaseClient.from("users_login").select("count").single();console.log("Basic query worked:",e)}catch(e){console.log("Basic query failed:",e)}}async function freshClientTest(){const e=supabase.createClient("https://yxicubfthxkwqcihrdhe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4aWN1YmZ0aHhrd3FjaWhyZGhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMjg3NDEsImV4cCI6MjA3MzgwNDc0MX0.-w4VQhAIF0kYLHv87JazGLxgX-r4VXCJaPVSmOUher4");console.log("Testing with completely fresh client...");const t=await e.from("feedback_posts").select("*").limit(1);console.log("Fresh client result:",t)}window.addEventListener("userDataReady",e=>{console.log("User data ready:",e.detail),currentUser=e.detail,initializeFeedback()}),setTimeout(()=>{window.currentUserData&&!currentUser&&(console.log("Using existing user data"),currentUser=window.currentUserData,initializeFeedback())},100)</script></body></html>